require_relative '../spec_helper.rb'

describe Cvent::Event do

  describe ".get_updated_ids" do
    let(:event_error_response) { double(:body => {:not_the_right_key => "baddata"}) }
    let(:event_success_response) { double(:body => {:get_updated_response => { :get_updated_result => { :id => ["ABC1234", "DEF6789"] }}}) }

    context "when the request fails" do
      before(:each) do
        Cvent::Client.stub_chain(:instance, :call).and_return(event_error_response)
      end

      it "returns an empty array" do
        Cvent::Event.get_updated_ids(DateTime.now - 14).should == []
      end
    end

    context "when the request raises an exception" do
      before(:each) do
        Cvent::Client.stub_chain(:instance, :call).and_raise(StandardError.new("Test Error"))
      end

      it "returns an empty array" do
        Cvent::Event.get_updated_ids(DateTime.now - 14).should == []
      end
    end

    context "when events are returned by the api" do
      before(:each) do
        Cvent::Client.stub_chain(:instance, :call).and_return(event_success_response)
      end

      it "Returns an array of their ids" do
        Cvent::Event.get_updated_ids(DateTime.now - 14).should == ["ABC1234", "DEF6789"]
      end
    end
  end

  describe ".fetch_from_ids" do
    let(:event_error_response) { double(:body => {:not_the_right_key => "baddata"}) }
    let(:event_single_response) { double(:body => {:retrieve_response => { :retrieve_result => { :cv_object => 
      {:product_detail=>{:@product_id=>"7D2F5621-9E5A-4085-BD5C-7DA56379AC71", :@product_name=>"Event Registration", :@product_code=>"", :@product_type=>"Admission Item", :@product_description=>"", :@session_category_name=>"", :@session_category_id=>"00000000-0000-0000-0000-000000000000", :@is_included=>"false", :@status=>"Active", :@capacity=>"-1"}, :weblink_detail=>[{:@target=>"Custom Page 10", :@url=>"http://www.cvent.com/d/n4qlpx/1J"}, {:@target=>"Custom Page 113", :@url=>"http://www.cvent.com/d/n4qlpx/113K"}, {:@target=>"Custom Page 114", :@url=>"http://www.cvent.com/d/n4qlpx/114K"}, {:@target=>"Custom Page 115", :@url=>"http://www.cvent.com/d/n4qlpx/115K"}, {:@target=>"Custom Page 116", :@url=>"http://www.cvent.com/d/n4qlpx/116K"}, {:@target=>"Custom Page 117", :@url=>"http://www.cvent.com/d/n4qlpx/117K"}, {:@target=>"Custom Page 118", :@url=>"http://www.cvent.com/d/n4qlpx/118K"}, {:@target=>"Custom Page 119", :@url=>"http://www.cvent.com/d/n4qlpx/119K"}, {:@target=>"Custom Page 11", :@url=>"http://www.cvent.com/d/n4qlpx/2J"}, {:@target=>"Custom Page 120", :@url=>"http://www.cvent.com/d/n4qlpx/120K"}, {:@target=>"Custom Page 121", :@url=>"http://www.cvent.com/d/n4qlpx/121K"}, {:@target=>"Custom Page 122", :@url=>"http://www.cvent.com/d/n4qlpx/122K"}, {:@target=>"Custom Page 123", :@url=>"http://www.cvent.com/d/n4qlpx/123K"}, {:@target=>"Custom Page 124", :@url=>"http://www.cvent.com/d/n4qlpx/124K"}, {:@target=>"Custom Page 125", :@url=>"http://www.cvent.com/d/n4qlpx/125K"}, {:@target=>"Custom Page 126", :@url=>"http://www.cvent.com/d/n4qlpx/126K"}, {:@target=>"Custom Page 127", :@url=>"http://www.cvent.com/d/n4qlpx/127K"}, {:@target=>"Custom Page 128", :@url=>"http://www.cvent.com/d/n4qlpx/128K"}, {:@target=>"Custom Page 129", :@url=>"http://www.cvent.com/d/n4qlpx/129K"}, {:@target=>"Custom Page 12", :@url=>"http://www.cvent.com/d/n4qlpx/3J"}, {:@target=>"Custom Page 130", :@url=>"http://www.cvent.com/d/n4qlpx/130K"}, {:@target=>"Custom Page 131", :@url=>"http://www.cvent.com/d/n4qlpx/131K"}, {:@target=>"Custom Page 132", :@url=>"http://www.cvent.com/d/n4qlpx/132K"}, {:@target=>"Custom Page 133", :@url=>"http://www.cvent.com/d/n4qlpx/133K"}, {:@target=>"Custom Page 134", :@url=>"http://www.cvent.com/d/n4qlpx/134K"}, {:@target=>"Custom Page 135", :@url=>"http://www.cvent.com/d/n4qlpx/135K"}, {:@target=>"Custom Page 136", :@url=>"http://www.cvent.com/d/n4qlpx/136K"}, {:@target=>"Custom Page 137", :@url=>"http://www.cvent.com/d/n4qlpx/137K"}, {:@target=>"Custom Page 138", :@url=>"http://www.cvent.com/d/n4qlpx/138K"}, {:@target=>"Custom Page 139", :@url=>"http://www.cvent.com/d/n4qlpx/139K"}, {:@target=>"Custom Page 140", :@url=>"http://www.cvent.com/d/n4qlpx/140K"}, {:@target=>"Custom Page 141", :@url=>"http://www.cvent.com/d/n4qlpx/141K"}, {:@target=>"Custom Page 142", :@url=>"http://www.cvent.com/d/n4qlpx/142K"}, {:@target=>"Custom Page 143", :@url=>"http://www.cvent.com/d/n4qlpx/143K"}, {:@target=>"Custom Page 144", :@url=>"http://www.cvent.com/d/n4qlpx/144K"}, {:@target=>"Custom Page 145", :@url=>"http://www.cvent.com/d/n4qlpx/145K"}, {:@target=>"Custom Page 146", :@url=>"http://www.cvent.com/d/n4qlpx/146K"}, {:@target=>"Custom Page 147", :@url=>"http://www.cvent.com/d/n4qlpx/147K"}, {:@target=>"Custom Page 148", :@url=>"http://www.cvent.com/d/n4qlpx/148K"}, {:@target=>"Custom Page 149", :@url=>"http://www.cvent.com/d/n4qlpx/149K"}, {:@target=>"Custom Page 150", :@url=>"http://www.cvent.com/d/n4qlpx/150K"}, {:@target=>"Custom Page 151", :@url=>"http://www.cvent.com/d/n4qlpx/151K"}, {:@target=>"Custom Page 152", :@url=>"http://www.cvent.com/d/n4qlpx/152K"}, {:@target=>"Custom Page 153", :@url=>"http://www.cvent.com/d/n4qlpx/153K"}, {:@target=>"Custom Page 154", :@url=>"http://www.cvent.com/d/n4qlpx/154K"}, {:@target=>"Custom Page 155", :@url=>"http://www.cvent.com/d/n4qlpx/155K"}, {:@target=>"Custom Page 156", :@url=>"http://www.cvent.com/d/n4qlpx/156K"}, {:@target=>"Custom Page 157", :@url=>"http://www.cvent.com/d/n4qlpx/157K"}, {:@target=>"Custom Page 158", :@url=>"http://www.cvent.com/d/n4qlpx/158K"}, {:@target=>"Custom Page 159", :@url=>"http://www.cvent.com/d/n4qlpx/159K"}, {:@target=>"Custom Page 160", :@url=>"http://www.cvent.com/d/n4qlpx/160K"}, {:@target=>"Custom Page 161", :@url=>"http://www.cvent.com/d/n4qlpx/161K"}, {:@target=>"Custom Page 162", :@url=>"http://www.cvent.com/d/n4qlpx/162K"}, {:@target=>"Custom Page 163", :@url=>"http://www.cvent.com/d/n4qlpx/163K"}, {:@target=>"Custom Page 164", :@url=>"http://www.cvent.com/d/n4qlpx/164K"}, {:@target=>"Custom Page 165", :@url=>"http://www.cvent.com/d/n4qlpx/165K"}, {:@target=>"Custom Page 166", :@url=>"http://www.cvent.com/d/n4qlpx/166K"}, {:@target=>"Custom Page 167", :@url=>"http://www.cvent.com/d/n4qlpx/167K"}, {:@target=>"Custom Page 168", :@url=>"http://www.cvent.com/d/n4qlpx/168K"}, {:@target=>"Custom Page 169", :@url=>"http://www.cvent.com/d/n4qlpx/169K"}, {:@target=>"Custom Page 170", :@url=>"http://www.cvent.com/d/n4qlpx/170K"}, {:@target=>"Custom Page 171", :@url=>"http://www.cvent.com/d/n4qlpx/171K"}, {:@target=>"Custom Page 172", :@url=>"http://www.cvent.com/d/n4qlpx/172K"}, {:@target=>"Custom Page 173", :@url=>"http://www.cvent.com/d/n4qlpx/173K"}, {:@target=>"Custom Page 174", :@url=>"http://www.cvent.com/d/n4qlpx/174K"}, {:@target=>"Custom Page 175", :@url=>"http://www.cvent.com/d/n4qlpx/175K"}, {:@target=>"Custom Page 176", :@url=>"http://www.cvent.com/d/n4qlpx/176K"}, {:@target=>"Custom Page 177", :@url=>"http://www.cvent.com/d/n4qlpx/177K"}, {:@target=>"Custom Page 178", :@url=>"http://www.cvent.com/d/n4qlpx/178K"}, {:@target=>"Custom Page 179", :@url=>"http://www.cvent.com/d/n4qlpx/179K"}, {:@target=>"Custom Page 180", :@url=>"http://www.cvent.com/d/n4qlpx/180K"}, {:@target=>"Custom Page 181", :@url=>"http://www.cvent.com/d/n4qlpx/181K"}, {:@target=>"Custom Page 182", :@url=>"http://www.cvent.com/d/n4qlpx/182K"}, {:@target=>"Custom Page 183", :@url=>"http://www.cvent.com/d/n4qlpx/183K"}, {:@target=>"Custom Page 184", :@url=>"http://www.cvent.com/d/n4qlpx/184K"}, {:@target=>"Custom Page 185", :@url=>"http://www.cvent.com/d/n4qlpx/185K"}, {:@target=>"Custom Page 186", :@url=>"http://www.cvent.com/d/n4qlpx/186K"}, {:@target=>"Custom Page 187", :@url=>"http://www.cvent.com/d/n4qlpx/187K"}, {:@target=>"Custom Page 188", :@url=>"http://www.cvent.com/d/n4qlpx/188K"}, {:@target=>"Custom Page 189", :@url=>"http://www.cvent.com/d/n4qlpx/189K"}, {:@target=>"Custom Page 190", :@url=>"http://www.cvent.com/d/n4qlpx/190K"}, {:@target=>"Custom Page 191", :@url=>"http://www.cvent.com/d/n4qlpx/191K"}, {:@target=>"Custom Page 192", :@url=>"http://www.cvent.com/d/n4qlpx/192K"}, {:@target=>"Custom Page 193", :@url=>"http://www.cvent.com/d/n4qlpx/193K"}, {:@target=>"Custom Page 194", :@url=>"http://www.cvent.com/d/n4qlpx/194K"}, {:@target=>"Custom Page 195", :@url=>"http://www.cvent.com/d/n4qlpx/195K"}, {:@target=>"Custom Page 196", :@url=>"http://www.cvent.com/d/n4qlpx/196K"}, {:@target=>"Custom Page 197", :@url=>"http://www.cvent.com/d/n4qlpx/197K"}, {:@target=>"Custom Page 198", :@url=>"http://www.cvent.com/d/n4qlpx/198K"}, {:@target=>"Custom Page 199", :@url=>"http://www.cvent.com/d/n4qlpx/199K"}, {:@target=>"Custom Page 10", :@url=>"http://www.cvent.com/d/n4qlpx/1J"}, {:@target=>"Custom Page 1", :@url=>"http://www.cvent.com/d/n4qlpx/1K"}, {:@target=>"Website Invitation", :@url=>"http://www.cvent.com/d/n4qlpx/1Q"}, {:@target=>"Custom Page 200", :@url=>"http://www.cvent.com/d/n4qlpx/200K"}, {:@target=>"Custom Page 11", :@url=>"http://www.cvent.com/d/n4qlpx/2J"}, {:@target=>"Custom Page 2", :@url=>"http://www.cvent.com/d/n4qlpx/2K"}, {:@target=>"Custom Page 12", :@url=>"http://www.cvent.com/d/n4qlpx/3J"}, {:@target=>"Custom Page 3", :@url=>"http://www.cvent.com/d/n4qlpx/3K"}, {:@target=>"Regret Survey", :@url=>"http://www.cvent.com/d/n4qlpx/3Z"}, {:@target=>"Custom Page 4", :@url=>"http://www.cvent.com/d/n4qlpx/4K"}, {:@target=>"Registration", :@url=>"http://www.cvent.com/d/n4qlpx/4W"}, {:@target=>"MobileHub", :@url=>"http://www.cvent.com/d/n4qlpx/5C"}, {:@target=>"AddAppointment", :@url=>"http://www.cvent.com/d/n4qlpx/5D"}, {:@target=>"Custom Page 5", :@url=>"http://www.cvent.com/d/n4qlpx/5K"}, {:@target=>"Event Summary", :@url=>"http://www.cvent.com/d/n4qlpx"}, {:@target=>"Send Confirmation Number", :@url=>"http://www.cvent.com/d/n4qlpx/6D"}, {:@target=>"Custom Page 6", :@url=>"http://www.cvent.com/d/n4qlpx/6K"}, {:@target=>"Event Agenda", :@url=>"http://www.cvent.com/d/n4qlpx/6X"}, {:@target=>"Feedback Survey", :@url=>"http://www.cvent.com/d/n4qlpx/7E"}, {:@target=>"Custom Page 7", :@url=>"http://www.cvent.com/d/n4qlpx/7K"}, {:@target=>"Custom Page 8", :@url=>"http://www.cvent.com/d/n4qlpx/8K"}, {:@target=>"Call it self with a new invitee_stub and dispatch_id = 1Q", :@url=>"http://www.cvent.com/d/n4qlpx/9D"}, {:@target=>"Custom Page 9", :@url=>"http://www.cvent.com/d/n4qlpx/9K"}], :target_list_detail=>{:@targeted_list_id=>"716BEAAA-E2CE-4619-82FA-5B81D8B7AEB6", :@targeted_list_name=>"Invitation List", :@targeted_list_language=>"English", :@targeted_list_default=>"true"}, :"@xsi:type"=>"Event", :@id=>"730B988C-F968-4C86-8C65-5A4E149E24D9", :@event_title=>"Test Event", :@event_code=>"XHN9PVNPH3F", :@event_start_date=>"2014-01-16T18:00:00", :@event_end_date=>"2014-01-16T22:00:00", :@event_launch_date=>"2013-12-17T13:15:19.11", :@timezone=>"Eastern Time Zone", :@event_description=>"This is a test event", :@internal_note=>"", :@event_status=>"Active", :@capacity=>"400", :@category=>"Celebration", :@meeting_request_id=>"00000000-0000-0000-0000-000000000000", :@currency=>"U.S. Dollar", :@planning_status=>"", :@location=>"The City Club", :@street_address1=>"850 Euclid Ave #200", :@street_address2=>"", :@street_address3=>"", :@city=>"Cleveland", :@state=>"Ohio", :@state_code=>"OH", :@postal_code=>"44114", :@country=>"USA", :@country_code=>"US", :@phone_number=>"(216) 621-0082", :@planner_first_name=>"Josh", :@planner_last_name=>"Schramm", :@planner_email_address=>"salesdemo01@gmail.com", :@last_modified_date=>"2013-12-17T13:15:19.5", :@rsv_pby_date=>"2014-01-16T23:59:00", :@archive_date=>"2014-04-16T00:00:00", :@closed_by=>"", :@external_authentication=>"true"}
    }}}) }
    let(:event_multiple_response) { double(:body => {:retrieve_response => { :retrieve_result => { :cv_object => 
      [{:product_detail=>{:@product_id=>"7D2F5621-9E5A-4085-BD5C-7DA56379AC71", :@product_name=>"Event Registration", :@product_code=>"", :@product_type=>"Admission Item", :@product_description=>"", :@session_category_name=>"", :@session_category_id=>"00000000-0000-0000-0000-000000000000", :@is_included=>"false", :@status=>"Active", :@capacity=>"-1"}, :weblink_detail=>[{:@target=>"Custom Page 10", :@url=>"http://www.cvent.com/d/n4qlpx/1J"}, {:@target=>"Custom Page 113", :@url=>"http://www.cvent.com/d/n4qlpx/113K"}, {:@target=>"Custom Page 114", :@url=>"http://www.cvent.com/d/n4qlpx/114K"}, {:@target=>"Custom Page 115", :@url=>"http://www.cvent.com/d/n4qlpx/115K"}, {:@target=>"Custom Page 116", :@url=>"http://www.cvent.com/d/n4qlpx/116K"}, {:@target=>"Custom Page 117", :@url=>"http://www.cvent.com/d/n4qlpx/117K"}, {:@target=>"Custom Page 118", :@url=>"http://www.cvent.com/d/n4qlpx/118K"}, {:@target=>"Custom Page 119", :@url=>"http://www.cvent.com/d/n4qlpx/119K"}, {:@target=>"Custom Page 11", :@url=>"http://www.cvent.com/d/n4qlpx/2J"}, {:@target=>"Custom Page 120", :@url=>"http://www.cvent.com/d/n4qlpx/120K"}, {:@target=>"Custom Page 121", :@url=>"http://www.cvent.com/d/n4qlpx/121K"}, {:@target=>"Custom Page 122", :@url=>"http://www.cvent.com/d/n4qlpx/122K"}, {:@target=>"Custom Page 123", :@url=>"http://www.cvent.com/d/n4qlpx/123K"}, {:@target=>"Custom Page 124", :@url=>"http://www.cvent.com/d/n4qlpx/124K"}, {:@target=>"Custom Page 125", :@url=>"http://www.cvent.com/d/n4qlpx/125K"}, {:@target=>"Custom Page 126", :@url=>"http://www.cvent.com/d/n4qlpx/126K"}, {:@target=>"Custom Page 127", :@url=>"http://www.cvent.com/d/n4qlpx/127K"}, {:@target=>"Custom Page 128", :@url=>"http://www.cvent.com/d/n4qlpx/128K"}, {:@target=>"Custom Page 129", :@url=>"http://www.cvent.com/d/n4qlpx/129K"}, {:@target=>"Custom Page 12", :@url=>"http://www.cvent.com/d/n4qlpx/3J"}, {:@target=>"Custom Page 130", :@url=>"http://www.cvent.com/d/n4qlpx/130K"}, {:@target=>"Custom Page 131", :@url=>"http://www.cvent.com/d/n4qlpx/131K"}, {:@target=>"Custom Page 132", :@url=>"http://www.cvent.com/d/n4qlpx/132K"}, {:@target=>"Custom Page 133", :@url=>"http://www.cvent.com/d/n4qlpx/133K"}, {:@target=>"Custom Page 134", :@url=>"http://www.cvent.com/d/n4qlpx/134K"}, {:@target=>"Custom Page 135", :@url=>"http://www.cvent.com/d/n4qlpx/135K"}, {:@target=>"Custom Page 136", :@url=>"http://www.cvent.com/d/n4qlpx/136K"}, {:@target=>"Custom Page 137", :@url=>"http://www.cvent.com/d/n4qlpx/137K"}, {:@target=>"Custom Page 138", :@url=>"http://www.cvent.com/d/n4qlpx/138K"}, {:@target=>"Custom Page 139", :@url=>"http://www.cvent.com/d/n4qlpx/139K"}, {:@target=>"Custom Page 140", :@url=>"http://www.cvent.com/d/n4qlpx/140K"}, {:@target=>"Custom Page 141", :@url=>"http://www.cvent.com/d/n4qlpx/141K"}, {:@target=>"Custom Page 142", :@url=>"http://www.cvent.com/d/n4qlpx/142K"}, {:@target=>"Custom Page 143", :@url=>"http://www.cvent.com/d/n4qlpx/143K"}, {:@target=>"Custom Page 144", :@url=>"http://www.cvent.com/d/n4qlpx/144K"}, {:@target=>"Custom Page 145", :@url=>"http://www.cvent.com/d/n4qlpx/145K"}, {:@target=>"Custom Page 146", :@url=>"http://www.cvent.com/d/n4qlpx/146K"}, {:@target=>"Custom Page 147", :@url=>"http://www.cvent.com/d/n4qlpx/147K"}, {:@target=>"Custom Page 148", :@url=>"http://www.cvent.com/d/n4qlpx/148K"}, {:@target=>"Custom Page 149", :@url=>"http://www.cvent.com/d/n4qlpx/149K"}, {:@target=>"Custom Page 150", :@url=>"http://www.cvent.com/d/n4qlpx/150K"}, {:@target=>"Custom Page 151", :@url=>"http://www.cvent.com/d/n4qlpx/151K"}, {:@target=>"Custom Page 152", :@url=>"http://www.cvent.com/d/n4qlpx/152K"}, {:@target=>"Custom Page 153", :@url=>"http://www.cvent.com/d/n4qlpx/153K"}, {:@target=>"Custom Page 154", :@url=>"http://www.cvent.com/d/n4qlpx/154K"}, {:@target=>"Custom Page 155", :@url=>"http://www.cvent.com/d/n4qlpx/155K"}, {:@target=>"Custom Page 156", :@url=>"http://www.cvent.com/d/n4qlpx/156K"}, {:@target=>"Custom Page 157", :@url=>"http://www.cvent.com/d/n4qlpx/157K"}, {:@target=>"Custom Page 158", :@url=>"http://www.cvent.com/d/n4qlpx/158K"}, {:@target=>"Custom Page 159", :@url=>"http://www.cvent.com/d/n4qlpx/159K"}, {:@target=>"Custom Page 160", :@url=>"http://www.cvent.com/d/n4qlpx/160K"}, {:@target=>"Custom Page 161", :@url=>"http://www.cvent.com/d/n4qlpx/161K"}, {:@target=>"Custom Page 162", :@url=>"http://www.cvent.com/d/n4qlpx/162K"}, {:@target=>"Custom Page 163", :@url=>"http://www.cvent.com/d/n4qlpx/163K"}, {:@target=>"Custom Page 164", :@url=>"http://www.cvent.com/d/n4qlpx/164K"}, {:@target=>"Custom Page 165", :@url=>"http://www.cvent.com/d/n4qlpx/165K"}, {:@target=>"Custom Page 166", :@url=>"http://www.cvent.com/d/n4qlpx/166K"}, {:@target=>"Custom Page 167", :@url=>"http://www.cvent.com/d/n4qlpx/167K"}, {:@target=>"Custom Page 168", :@url=>"http://www.cvent.com/d/n4qlpx/168K"}, {:@target=>"Custom Page 169", :@url=>"http://www.cvent.com/d/n4qlpx/169K"}, {:@target=>"Custom Page 170", :@url=>"http://www.cvent.com/d/n4qlpx/170K"}, {:@target=>"Custom Page 171", :@url=>"http://www.cvent.com/d/n4qlpx/171K"}, {:@target=>"Custom Page 172", :@url=>"http://www.cvent.com/d/n4qlpx/172K"}, {:@target=>"Custom Page 173", :@url=>"http://www.cvent.com/d/n4qlpx/173K"}, {:@target=>"Custom Page 174", :@url=>"http://www.cvent.com/d/n4qlpx/174K"}, {:@target=>"Custom Page 175", :@url=>"http://www.cvent.com/d/n4qlpx/175K"}, {:@target=>"Custom Page 176", :@url=>"http://www.cvent.com/d/n4qlpx/176K"}, {:@target=>"Custom Page 177", :@url=>"http://www.cvent.com/d/n4qlpx/177K"}, {:@target=>"Custom Page 178", :@url=>"http://www.cvent.com/d/n4qlpx/178K"}, {:@target=>"Custom Page 179", :@url=>"http://www.cvent.com/d/n4qlpx/179K"}, {:@target=>"Custom Page 180", :@url=>"http://www.cvent.com/d/n4qlpx/180K"}, {:@target=>"Custom Page 181", :@url=>"http://www.cvent.com/d/n4qlpx/181K"}, {:@target=>"Custom Page 182", :@url=>"http://www.cvent.com/d/n4qlpx/182K"}, {:@target=>"Custom Page 183", :@url=>"http://www.cvent.com/d/n4qlpx/183K"}, {:@target=>"Custom Page 184", :@url=>"http://www.cvent.com/d/n4qlpx/184K"}, {:@target=>"Custom Page 185", :@url=>"http://www.cvent.com/d/n4qlpx/185K"}, {:@target=>"Custom Page 186", :@url=>"http://www.cvent.com/d/n4qlpx/186K"}, {:@target=>"Custom Page 187", :@url=>"http://www.cvent.com/d/n4qlpx/187K"}, {:@target=>"Custom Page 188", :@url=>"http://www.cvent.com/d/n4qlpx/188K"}, {:@target=>"Custom Page 189", :@url=>"http://www.cvent.com/d/n4qlpx/189K"}, {:@target=>"Custom Page 190", :@url=>"http://www.cvent.com/d/n4qlpx/190K"}, {:@target=>"Custom Page 191", :@url=>"http://www.cvent.com/d/n4qlpx/191K"}, {:@target=>"Custom Page 192", :@url=>"http://www.cvent.com/d/n4qlpx/192K"}, {:@target=>"Custom Page 193", :@url=>"http://www.cvent.com/d/n4qlpx/193K"}, {:@target=>"Custom Page 194", :@url=>"http://www.cvent.com/d/n4qlpx/194K"}, {:@target=>"Custom Page 195", :@url=>"http://www.cvent.com/d/n4qlpx/195K"}, {:@target=>"Custom Page 196", :@url=>"http://www.cvent.com/d/n4qlpx/196K"}, {:@target=>"Custom Page 197", :@url=>"http://www.cvent.com/d/n4qlpx/197K"}, {:@target=>"Custom Page 198", :@url=>"http://www.cvent.com/d/n4qlpx/198K"}, {:@target=>"Custom Page 199", :@url=>"http://www.cvent.com/d/n4qlpx/199K"}, {:@target=>"Custom Page 10", :@url=>"http://www.cvent.com/d/n4qlpx/1J"}, {:@target=>"Custom Page 1", :@url=>"http://www.cvent.com/d/n4qlpx/1K"}, {:@target=>"Website Invitation", :@url=>"http://www.cvent.com/d/n4qlpx/1Q"}, {:@target=>"Custom Page 200", :@url=>"http://www.cvent.com/d/n4qlpx/200K"}, {:@target=>"Custom Page 11", :@url=>"http://www.cvent.com/d/n4qlpx/2J"}, {:@target=>"Custom Page 2", :@url=>"http://www.cvent.com/d/n4qlpx/2K"}, {:@target=>"Custom Page 12", :@url=>"http://www.cvent.com/d/n4qlpx/3J"}, {:@target=>"Custom Page 3", :@url=>"http://www.cvent.com/d/n4qlpx/3K"}, {:@target=>"Regret Survey", :@url=>"http://www.cvent.com/d/n4qlpx/3Z"}, {:@target=>"Custom Page 4", :@url=>"http://www.cvent.com/d/n4qlpx/4K"}, {:@target=>"Registration", :@url=>"http://www.cvent.com/d/n4qlpx/4W"}, {:@target=>"MobileHub", :@url=>"http://www.cvent.com/d/n4qlpx/5C"}, {:@target=>"AddAppointment", :@url=>"http://www.cvent.com/d/n4qlpx/5D"}, {:@target=>"Custom Page 5", :@url=>"http://www.cvent.com/d/n4qlpx/5K"}, {:@target=>"Event Summary", :@url=>"http://www.cvent.com/d/n4qlpx"}, {:@target=>"Send Confirmation Number", :@url=>"http://www.cvent.com/d/n4qlpx/6D"}, {:@target=>"Custom Page 6", :@url=>"http://www.cvent.com/d/n4qlpx/6K"}, {:@target=>"Event Agenda", :@url=>"http://www.cvent.com/d/n4qlpx/6X"}, {:@target=>"Feedback Survey", :@url=>"http://www.cvent.com/d/n4qlpx/7E"}, {:@target=>"Custom Page 7", :@url=>"http://www.cvent.com/d/n4qlpx/7K"}, {:@target=>"Custom Page 8", :@url=>"http://www.cvent.com/d/n4qlpx/8K"}, {:@target=>"Call it self with a new invitee_stub and dispatch_id = 1Q", :@url=>"http://www.cvent.com/d/n4qlpx/9D"}, {:@target=>"Custom Page 9", :@url=>"http://www.cvent.com/d/n4qlpx/9K"}], :target_list_detail=>{:@targeted_list_id=>"716BEAAA-E2CE-4619-82FA-5B81D8B7AEB6", :@targeted_list_name=>"Invitation List", :@targeted_list_language=>"English", :@targeted_list_default=>"true"}, :"@xsi:type"=>"Event", :@id=>"730B988C-F968-4C86-8C65-5A4E149E24D9", :@event_title=>"Test Event", :@event_code=>"XHN9PVNPH3F", :@event_start_date=>"2014-01-16T18:00:00", :@event_end_date=>"2014-01-16T22:00:00", :@event_launch_date=>"2013-12-17T13:15:19.11", :@timezone=>"Eastern Time Zone", :@event_description=>"This is a test event", :@internal_note=>"", :@event_status=>"Active", :@capacity=>"400", :@category=>"Celebration", :@meeting_request_id=>"00000000-0000-0000-0000-000000000000", :@currency=>"U.S. Dollar", :@planning_status=>"", :@location=>"The City Club", :@street_address1=>"850 Euclid Ave #200", :@street_address2=>"", :@street_address3=>"", :@city=>"Cleveland", :@state=>"Ohio", :@state_code=>"OH", :@postal_code=>"44114", :@country=>"USA", :@country_code=>"US", :@phone_number=>"(216) 621-0082", :@planner_first_name=>"Josh", :@planner_last_name=>"Schramm", :@planner_email_address=>"salesdemo01@gmail.com", :@last_modified_date=>"2013-12-17T13:15:19.5", :@rsv_pby_date=>"2014-01-16T23:59:00", :@archive_date=>"2014-04-16T00:00:00", :@closed_by=>"", :@external_authentication=>"true"}, 
       {:product_detail=>{:@product_id=>"3C9488C0-18EC-48F1-8CBD-7D2F1EE060C0", :@product_name=>"Event Registration", :@product_code=>"", :@product_type=>"Admission Item", :@product_description=>"", :@session_category_name=>"", :@session_category_id=>"00000000-0000-0000-0000-000000000000", :@is_included=>"false", :@status=>"Active", :@capacity=>"-1"}, :weblink_detail=>[{:@target=>"Custom Page 10", :@url=>"http://www.cvent.com/d/b4qllv/1J"}, {:@target=>"Custom Page 113", :@url=>"http://www.cvent.com/d/b4qllv/113K"}, {:@target=>"Custom Page 114", :@url=>"http://www.cvent.com/d/b4qllv/114K"}, {:@target=>"Custom Page 115", :@url=>"http://www.cvent.com/d/b4qllv/115K"}, {:@target=>"Custom Page 116", :@url=>"http://www.cvent.com/d/b4qllv/116K"}, {:@target=>"Custom Page 117", :@url=>"http://www.cvent.com/d/b4qllv/117K"}, {:@target=>"Custom Page 118", :@url=>"http://www.cvent.com/d/b4qllv/118K"}, {:@target=>"Custom Page 119", :@url=>"http://www.cvent.com/d/b4qllv/119K"}, {:@target=>"Custom Page 11", :@url=>"http://www.cvent.com/d/b4qllv/2J"}, {:@target=>"Custom Page 120", :@url=>"http://www.cvent.com/d/b4qllv/120K"}, {:@target=>"Custom Page 121", :@url=>"http://www.cvent.com/d/b4qllv/121K"}, {:@target=>"Custom Page 122", :@url=>"http://www.cvent.com/d/b4qllv/122K"}, {:@target=>"Custom Page 123", :@url=>"http://www.cvent.com/d/b4qllv/123K"}, {:@target=>"Custom Page 124", :@url=>"http://www.cvent.com/d/b4qllv/124K"}, {:@target=>"Custom Page 125", :@url=>"http://www.cvent.com/d/b4qllv/125K"}, {:@target=>"Custom Page 126", :@url=>"http://www.cvent.com/d/b4qllv/126K"}, {:@target=>"Custom Page 127", :@url=>"http://www.cvent.com/d/b4qllv/127K"}, {:@target=>"Custom Page 128", :@url=>"http://www.cvent.com/d/b4qllv/128K"}, {:@target=>"Custom Page 129", :@url=>"http://www.cvent.com/d/b4qllv/129K"}, {:@target=>"Custom Page 12", :@url=>"http://www.cvent.com/d/b4qllv/3J"}, {:@target=>"Custom Page 130", :@url=>"http://www.cvent.com/d/b4qllv/130K"}, {:@target=>"Custom Page 131", :@url=>"http://www.cvent.com/d/b4qllv/131K"}, {:@target=>"Custom Page 132", :@url=>"http://www.cvent.com/d/b4qllv/132K"}, {:@target=>"Custom Page 133", :@url=>"http://www.cvent.com/d/b4qllv/133K"}, {:@target=>"Custom Page 134", :@url=>"http://www.cvent.com/d/b4qllv/134K"}, {:@target=>"Custom Page 135", :@url=>"http://www.cvent.com/d/b4qllv/135K"}, {:@target=>"Custom Page 136", :@url=>"http://www.cvent.com/d/b4qllv/136K"}, {:@target=>"Custom Page 137", :@url=>"http://www.cvent.com/d/b4qllv/137K"}, {:@target=>"Custom Page 138", :@url=>"http://www.cvent.com/d/b4qllv/138K"}, {:@target=>"Custom Page 139", :@url=>"http://www.cvent.com/d/b4qllv/139K"}, {:@target=>"Custom Page 140", :@url=>"http://www.cvent.com/d/b4qllv/140K"}, {:@target=>"Custom Page 141", :@url=>"http://www.cvent.com/d/b4qllv/141K"}, {:@target=>"Custom Page 142", :@url=>"http://www.cvent.com/d/b4qllv/142K"}, {:@target=>"Custom Page 143", :@url=>"http://www.cvent.com/d/b4qllv/143K"}, {:@target=>"Custom Page 144", :@url=>"http://www.cvent.com/d/b4qllv/144K"}, {:@target=>"Custom Page 145", :@url=>"http://www.cvent.com/d/b4qllv/145K"}, {:@target=>"Custom Page 146", :@url=>"http://www.cvent.com/d/b4qllv/146K"}, {:@target=>"Custom Page 147", :@url=>"http://www.cvent.com/d/b4qllv/147K"}, {:@target=>"Custom Page 148", :@url=>"http://www.cvent.com/d/b4qllv/148K"}, {:@target=>"Custom Page 149", :@url=>"http://www.cvent.com/d/b4qllv/149K"}, {:@target=>"Custom Page 150", :@url=>"http://www.cvent.com/d/b4qllv/150K"}, {:@target=>"Custom Page 151", :@url=>"http://www.cvent.com/d/b4qllv/151K"}, {:@target=>"Custom Page 152", :@url=>"http://www.cvent.com/d/b4qllv/152K"}, {:@target=>"Custom Page 153", :@url=>"http://www.cvent.com/d/b4qllv/153K"}, {:@target=>"Custom Page 154", :@url=>"http://www.cvent.com/d/b4qllv/154K"}, {:@target=>"Custom Page 155", :@url=>"http://www.cvent.com/d/b4qllv/155K"}, {:@target=>"Custom Page 156", :@url=>"http://www.cvent.com/d/b4qllv/156K"}, {:@target=>"Custom Page 157", :@url=>"http://www.cvent.com/d/b4qllv/157K"}, {:@target=>"Custom Page 158", :@url=>"http://www.cvent.com/d/b4qllv/158K"}, {:@target=>"Custom Page 159", :@url=>"http://www.cvent.com/d/b4qllv/159K"}, {:@target=>"Custom Page 160", :@url=>"http://www.cvent.com/d/b4qllv/160K"}, {:@target=>"Custom Page 161", :@url=>"http://www.cvent.com/d/b4qllv/161K"}, {:@target=>"Custom Page 162", :@url=>"http://www.cvent.com/d/b4qllv/162K"}, {:@target=>"Custom Page 163", :@url=>"http://www.cvent.com/d/b4qllv/163K"}, {:@target=>"Custom Page 164", :@url=>"http://www.cvent.com/d/b4qllv/164K"}, {:@target=>"Custom Page 165", :@url=>"http://www.cvent.com/d/b4qllv/165K"}, {:@target=>"Custom Page 166", :@url=>"http://www.cvent.com/d/b4qllv/166K"}, {:@target=>"Custom Page 167", :@url=>"http://www.cvent.com/d/b4qllv/167K"}, {:@target=>"Custom Page 168", :@url=>"http://www.cvent.com/d/b4qllv/168K"}, {:@target=>"Custom Page 169", :@url=>"http://www.cvent.com/d/b4qllv/169K"}, {:@target=>"Custom Page 170", :@url=>"http://www.cvent.com/d/b4qllv/170K"}, {:@target=>"Custom Page 171", :@url=>"http://www.cvent.com/d/b4qllv/171K"}, {:@target=>"Custom Page 172", :@url=>"http://www.cvent.com/d/b4qllv/172K"}, {:@target=>"Custom Page 173", :@url=>"http://www.cvent.com/d/b4qllv/173K"}, {:@target=>"Custom Page 174", :@url=>"http://www.cvent.com/d/b4qllv/174K"}, {:@target=>"Custom Page 175", :@url=>"http://www.cvent.com/d/b4qllv/175K"}, {:@target=>"Custom Page 176", :@url=>"http://www.cvent.com/d/b4qllv/176K"}, {:@target=>"Custom Page 177", :@url=>"http://www.cvent.com/d/b4qllv/177K"}, {:@target=>"Custom Page 178", :@url=>"http://www.cvent.com/d/b4qllv/178K"}, {:@target=>"Custom Page 179", :@url=>"http://www.cvent.com/d/b4qllv/179K"}, {:@target=>"Custom Page 180", :@url=>"http://www.cvent.com/d/b4qllv/180K"}, {:@target=>"Custom Page 181", :@url=>"http://www.cvent.com/d/b4qllv/181K"}, {:@target=>"Custom Page 182", :@url=>"http://www.cvent.com/d/b4qllv/182K"}, {:@target=>"Custom Page 183", :@url=>"http://www.cvent.com/d/b4qllv/183K"}, {:@target=>"Custom Page 184", :@url=>"http://www.cvent.com/d/b4qllv/184K"}, {:@target=>"Custom Page 185", :@url=>"http://www.cvent.com/d/b4qllv/185K"}, {:@target=>"Custom Page 186", :@url=>"http://www.cvent.com/d/b4qllv/186K"}, {:@target=>"Custom Page 187", :@url=>"http://www.cvent.com/d/b4qllv/187K"}, {:@target=>"Custom Page 188", :@url=>"http://www.cvent.com/d/b4qllv/188K"}, {:@target=>"Custom Page 189", :@url=>"http://www.cvent.com/d/b4qllv/189K"}, {:@target=>"Custom Page 190", :@url=>"http://www.cvent.com/d/b4qllv/190K"}, {:@target=>"Custom Page 191", :@url=>"http://www.cvent.com/d/b4qllv/191K"}, {:@target=>"Custom Page 192", :@url=>"http://www.cvent.com/d/b4qllv/192K"}, {:@target=>"Custom Page 193", :@url=>"http://www.cvent.com/d/b4qllv/193K"}, {:@target=>"Custom Page 194", :@url=>"http://www.cvent.com/d/b4qllv/194K"}, {:@target=>"Custom Page 195", :@url=>"http://www.cvent.com/d/b4qllv/195K"}, {:@target=>"Custom Page 196", :@url=>"http://www.cvent.com/d/b4qllv/196K"}, {:@target=>"Custom Page 197", :@url=>"http://www.cvent.com/d/b4qllv/197K"}, {:@target=>"Custom Page 198", :@url=>"http://www.cvent.com/d/b4qllv/198K"}, {:@target=>"Custom Page 199", :@url=>"http://www.cvent.com/d/b4qllv/199K"}, {:@target=>"Custom Page 10", :@url=>"http://www.cvent.com/d/b4qllv/1J"}, {:@target=>"Custom Page 1", :@url=>"http://www.cvent.com/d/b4qllv/1K"}, {:@target=>"Website Invitation", :@url=>"http://www.cvent.com/d/b4qllv/1Q"}, {:@target=>"Custom Page 200", :@url=>"http://www.cvent.com/d/b4qllv/200K"}, {:@target=>"Custom Page 11", :@url=>"http://www.cvent.com/d/b4qllv/2J"}, {:@target=>"Custom Page 2", :@url=>"http://www.cvent.com/d/b4qllv/2K"}, {:@target=>"Custom Page 12", :@url=>"http://www.cvent.com/d/b4qllv/3J"}, {:@target=>"Custom Page 3", :@url=>"http://www.cvent.com/d/b4qllv/3K"}, {:@target=>"Regret Survey", :@url=>"http://www.cvent.com/d/b4qllv/3Z"}, {:@target=>"Custom Page 4", :@url=>"http://www.cvent.com/d/b4qllv/4K"}, {:@target=>"Registration", :@url=>"http://www.cvent.com/d/b4qllv/4W"}, {:@target=>"MobileHub", :@url=>"http://www.cvent.com/d/b4qllv/5C"}, {:@target=>"AddAppointment", :@url=>"http://www.cvent.com/d/b4qllv/5D"}, {:@target=>"Custom Page 5", :@url=>"http://www.cvent.com/d/b4qllv/5K"}, {:@target=>"Event Summary", :@url=>"http://www.cvent.com/d/b4qllv"}, {:@target=>"Send Confirmation Number", :@url=>"http://www.cvent.com/d/b4qllv/6D"}, {:@target=>"Custom Page 6", :@url=>"http://www.cvent.com/d/b4qllv/6K"}, {:@target=>"Event Agenda", :@url=>"http://www.cvent.com/d/b4qllv/6X"}, {:@target=>"Feedback Survey", :@url=>"http://www.cvent.com/d/b4qllv/7E"}, {:@target=>"Custom Page 7", :@url=>"http://www.cvent.com/d/b4qllv/7K"}, {:@target=>"Custom Page 8", :@url=>"http://www.cvent.com/d/b4qllv/8K"}, {:@target=>"Call it self with a new invitee_stub and dispatch_id = 1Q", :@url=>"http://www.cvent.com/d/b4qllv/9D"}, {:@target=>"Custom Page 9", :@url=>"http://www.cvent.com/d/b4qllv/9K"}], :target_list_detail=>{:@targeted_list_id=>"16F3CEA4-ABDA-4091-A408-374409018C11", :@targeted_list_name=>"Invitation List", :@targeted_list_language=>"English", :@targeted_list_default=>"true"}, :"@xsi:type"=>"Event", :@id=>"78DB9F64-5C36-4F98-B497-63C0B12127D2", :@event_title=>"Sue Helper", :@event_code=>"DHNY8DN2Z6H", :@event_start_date=>"2014-01-17T09:00:00", :@event_end_date=>"2014-01-17T14:00:00", :@timezone=>"Eastern Time Zone", :@event_description=>"Chief Economist,\r\nU.S. Department of Commerce", :@internal_note=>"", :@event_status=>"Pending", :@capacity=>"250", :@category=>"Forum", :@meeting_request_id=>"00000000-0000-0000-0000-000000000000", :@currency=>"U.S. Dollar", :@planning_status=>"", :@location=>"The City Club of Cleveland", :@street_address1=>"850 Euclid Avenue", :@street_address2=>"", :@street_address3=>"", :@city=>"Cleveland", :@state=>"Ohio", :@state_code=>"OH", :@postal_code=>"44114", :@country=>"", :@country_code=>"", :@phone_number=>"", :@planner_first_name=>"Carrie", :@planner_last_name=>"Miller", :@planner_email_address=>"salesdemo01@gmail.com", :@last_modified_date=>"2013-12-16T14:47:11.613", :@rsv_pby_date=>"2014-01-15T23:59:00", :@archive_date=>"2014-04-15T00:00:00", :@closed_by=>"", :@external_authentication=>"false"}]
    }}}) }

    context "when no ids are passed" do
      it "returns an empty array" do
        Cvent::Event.fetch_from_ids.should == []
      end
    end

    context "when an event is returned" do
      before(:each) do 
        Cvent::Client.stub_chain(:instance, :call).and_return(event_single_response)
      end

      it "returns an event object with the fields filled in" do
        result = Cvent::Event.fetch_from_ids(["abc123"])
        result.length.should == 1
        result[0].title.should == "Test Event"
        result[0].code.should == "XHN9PVNPH3F"
        result[0].start_date.should == "2014-01-16T18:00:00"
        result[0].end_date.should == "2014-01-16T22:00:00"
        result[0].launch_date.should == "2013-12-17T13:15:19.11"
        result[0].timezone.should == "Eastern Time Zone"
        result[0].description.should == "This is a test event"
        result[0].internal_note.should == ""
        result[0].status.should == "Active"
        result[0].capacity.should == "400"
        result[0].category.should == "Celebration"
        result[0].meeting_request_id.should == "00000000-0000-0000-0000-000000000000"
        result[0].currency.should == "U.S. Dollar"
        result[0].planning_status.should == ""
        result[0].location.should == "The City Club"
        result[0].street_address1.should == "850 Euclid Ave #200"
        result[0].street_address2.should == ""
        result[0].street_address3.should == ""
        result[0].city.should == "Cleveland"
        result[0].state.should == "Ohio"
        result[0].state_code.should == "OH"
        result[0].postal_code.should == "44114"
        result[0].country.should == "USA"
        result[0].country_code.should == "US"
        result[0].phone_number.should == "(216) 621-0082"
        result[0].planner_first_name.should == "Josh"
        result[0].planner_last_name.should ==  "Schramm"
        result[0].planner_email_address.should == "salesdemo01@gmail.com"
        result[0].last_date_modified.should == "2013-12-17T13:15:19.5"
        result[0].rsvp_by_date.should == "2014-01-16T23:59:00"
        result[0].archive_date.should == "2014-04-16T00:00:00"
        result[0].closed_by.should == ""
        result[0].external_auth.should == "true"
      end
    end
  end
end
